# –ê–Ω–∞–ª–∏–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (Data Classes) ‚úÖ
- ‚úÖ `DownloadPlan` —Å–æ–∑–¥–∞–Ω (`src/models/download_plan.py`)
- ‚úÖ `LinkInfo` —Å–æ–∑–¥–∞–Ω (`src/models/link_info.py`)
- ‚úÖ `DownloadResponse` —Å–æ–∑–¥–∞–Ω (`src/models/download_response.py`)

### –≠—Ç–∞–ø 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ DownloadManager ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `download_manager.py` —Å –∫–ª–∞—Å—Å–æ–º `DownloadManager`
- ‚úÖ –ú–µ—Ç–æ–¥ `request_download()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚ö†Ô∏è `downloader.py` –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED)
- ‚ö†Ô∏è –ú–µ—Ç–æ–¥—ã `get_video_info()`, `get_available_formats()`, `download_with_ydl_opts()` –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ DEPRECATED, –Ω–æ –Ω–µ —É–¥–∞–ª–µ–Ω—ã

### –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ LinkProcessingService ‚úÖ
- ‚úÖ –£–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ (Redis, –æ—á–µ—Ä–µ–¥–∏, —Å—Ç–∞—Ç—É—Å—ã)
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ `process_link(url) -> LinkInfo`
- ‚úÖ –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `Database` –∏ `VideoDownloader`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç `ServiceFactory`

### –≠—Ç–∞–ø 4: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ PlatformService ‚úÖ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `BaseService` —Å –Ω–æ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏: `can_handle()`, `extract_video_id()`, `get_metadata()`, `build_download_plan()`
- ‚úÖ `InstagramService` —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω - —É–±—Ä–∞–Ω `download_video()`, –¥–æ–±–∞–≤–ª–µ–Ω `build_download_plan()`
- ‚úÖ `TikTokService` —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω - —É–±—Ä–∞–Ω `download_video()`, –¥–æ–±–∞–≤–ª–µ–Ω `build_download_plan()`
- ‚úÖ `YouTubeService` —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω - —É–±—Ä–∞–Ω `download_video()`, –¥–æ–±–∞–≤–ª–µ–Ω `build_download_plan()`
- ‚ö†Ô∏è –°—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ DEPRECATED)

### –≠—Ç–∞–ø 5: –°–æ–∑–¥–∞–Ω–∏–µ YtDlpService ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `YtDlpService` (`src/services/ytdlp_service.py`)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã: `get_info()`, `download_to_stream()`, `download_to_file()`

### –≠—Ç–∞–ø 6: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Worker ‚úÖ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `LinkProcessingService` ‚Üí `LinkInfo` ‚Üí `DownloadPlan` ‚Üí `YtDlpService`
- ‚úÖ –£–±—Ä–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `service.download_video()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `YtDlpService` –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è `DownloadPlan`

### –≠—Ç–∞–ø 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ bot.py ‚úÖ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `DownloadManager`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `process_video_download()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `download_manager.request_download()`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `callback_quality_handler()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `DownloadManager`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `callback_resend_handler()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `LinkProcessingService`

### –≠—Ç–∞–ø 8: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ ‚ö†Ô∏è
- ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚ö†Ô∏è `use_cases` –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `VideoDownloader` (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. PlatformService –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç VideoDownloader
**–ü—Ä–æ–±–ª–µ–º–∞:** `PlatformService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `self.downloader.get_video_info()` –∏ `self.downloader.get_available_formats()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

**–ê–Ω–∞–ª–∏–∑:** –≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ** –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ! `PlatformService` –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Å–µ—Ä–≤–∏—Å. –ù–æ —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `VideoDownloader`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED.

**–†–µ—à–µ–Ω–∏–µ:** 
- –í–∞—Ä–∏–∞–Ω—Ç 1: `PlatformService` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `YtDlpService` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Å—Ç–∞–≤–∏—Ç—å `VideoDownloader` –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `YtDlpInfoService` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ `YtDlpService`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã `get_info()` –≤ `YtDlpService` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ `PlatformService` –≤–º–µ—Å—Ç–æ `VideoDownloader`.

---

### 2. Use Cases –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç VideoDownloader
**–ü—Ä–æ–±–ª–µ–º–∞:** `use_cases` (HandleInlineQueryUseCase, DownloadVideoUseCase, etc.) –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `VideoDownloader` –Ω–∞–ø—Ä—è–º—É—é.

**–§–∞–π–ª—ã:**
- `src/use_cases/handle_inline_query.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `downloader.get_available_formats()`
- `src/use_cases/download_video.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `downloader.get_video_id()`
- `src/use_cases/handle_quality_selection.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `downloader.get_available_formats()`
- `src/use_cases/get_cached_video.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `downloader.get_video_id()`

**–ê–Ω–∞–ª–∏–∑:** Use cases –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `LinkProcessingService` –∏ `DownloadManager`, –∞ –Ω–µ `VideoDownloader` –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å use cases –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
- `HandleInlineQueryUseCase` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `LinkProcessingService` –∏ `YouTubeService.get_available_formats()`
- `DownloadVideoUseCase` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DownloadManager.request_download()`
- –û—Å—Ç–∞–ª—å–Ω—ã–µ use cases ‚Üí –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

---

### 3. VideoDownloader –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
**–ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- `src/bot/bot.py` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `video_id` (—Å—Ç—Ä–æ–∫–∞ 264)
- `src/workers/download_worker.py` - –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `src/services/service_factory.py` - –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å—ã
- `src/use_cases/*` - –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–ê–Ω–∞–ª–∏–∑:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** 
- –û—Å—Ç–∞–≤–∏—Ç—å `VideoDownloader` –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å use cases –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –í –±—É–¥—É—â–µ–º —É–¥–∞–ª–∏—Ç—å `VideoDownloader` –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

### 4. LinkProcessingService.process_link() –Ω–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç URL
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `LinkProcessingService.process_link()` —É–±—Ä–∞–Ω –≤—ã–∑–æ–≤ `normalize_url()`, —Ç–∞–∫ –∫–∞–∫ URL —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `DownloadManager`. –ù–æ –µ—Å–ª–∏ `process_link()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ use cases), URL –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω.

**–ê–Ω–∞–ª–∏–∑:** –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º, –µ—Å–ª–∏ `process_link()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ —á–µ—Ä–µ–∑ `DownloadManager`.

**–†–µ—à–µ–Ω–∏–µ:** 
- –í–∞—Ä–∏–∞–Ω—Ç 1: –í–µ—Ä–Ω—É—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –≤ `LinkProcessingService.process_link()` (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞)
- –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–µ—Ä–Ω—É—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –≤ `LinkProcessingService.process_link()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

### 5. Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç VideoDownloader –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ServiceFactory
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `Worker` —Å–æ–∑–¥–∞–µ—Ç—Å—è `VideoDownloader` —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ `ServiceFactory`.

**–ê–Ω–∞–ª–∏–∑:** –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ `PlatformService` –≤—Å–µ –µ—â–µ –Ω—É–∂–µ–Ω `VideoDownloader` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –¥–æ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ `YtDlpService`.

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–ª–∞–Ω—É
- ‚úÖ `DownloadManager` –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç, –Ω–µ –∑–Ω–∞–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º
- ‚úÖ `LinkProcessingService` - –º–æ–∑–≥ —Å–∏—Å—Ç–µ–º—ã, –Ω–µ –∑–Ω–∞–µ—Ç Redis/Telegram
- ‚úÖ `PlatformService` –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `DownloadPlan`
- ‚úÖ `YtDlpService` - –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Å–µ—Ä–≤–∏—Å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Worker
- ‚úÖ `Worker` - —Ç—É–ø–æ–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –∏—Å–ø–æ–ª–Ω—è–µ—Ç `DownloadPlan`

### 2. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ `DownloadPlan` - –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É –ª–æ–≥–∏–∫–æ–π –∏ –≤–æ—Ä–∫–µ—Ä–æ–º
- ‚úÖ `LinkInfo` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Å—ã–ª–∫–∏
- ‚úÖ `DownloadResponse` - –æ—Ç–≤–µ—Ç –æ—Ç DownloadManager

### 3. –ì—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ–±–ª—é–¥–µ–Ω—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –ù–ï –∫–∞—á–∞—é—Ç (–≤–æ–∑–≤—Ä–∞—â–∞—é—Ç DownloadPlan)
- ‚úÖ –í–æ—Ä–∫–µ—Ä—ã –ù–ï –¥—É–º–∞—é—Ç (–∏—Å–ø–æ–ª–Ω—è—é—Ç DownloadPlan)
- ‚úÖ DownloadManager –ù–ï –∑–Ω–∞–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º (–¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç LinkProcessingService)
- ‚úÖ PlatformService –ù–ï –∑–Ω–∞–µ—Ç Telegram (—Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç DownloadPlan)

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è PlatformService –Ω–∞ YtDlpService
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** `PlatformService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `VideoDownloader.get_video_info()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ü–µ—Ä–µ–¥–∞—Ç—å `YtDlpService` –≤ `PlatformService` –≤–º–µ—Å—Ç–æ `VideoDownloader`
- –û–±–Ω–æ–≤–∏—Ç—å `ServiceFactory` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `YtDlpService`
- –û–±–Ω–æ–≤–∏—Ç—å `PlatformService` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ytdlp_service.get_info()`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (—Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ)

---

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Use Cases
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** Use cases –∏—Å–ø–æ–ª—å–∑—É—é—Ç `VideoDownloader` –Ω–∞–ø—Ä—è–º—É—é.

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- `HandleInlineQueryUseCase` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `LinkProcessingService` –∏ `YouTubeService`
- `DownloadVideoUseCase` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DownloadManager.request_download()`
- –û—Å—Ç–∞–ª—å–Ω—ã–µ use cases ‚Üí –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (use cases —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)

---

### 3. –£–¥–∞–ª–µ–Ω–∏–µ VideoDownloader
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** `VideoDownloader` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED, –Ω–æ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –£–¥–∞–ª–∏—Ç—å `downloader.py`
- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã
- –ì—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ç–∫–∏–µ
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

### ‚ö†Ô∏è –ï—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥
- `VideoDownloader` –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω–æ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED)
- Use cases –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç)
- `PlatformService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `VideoDownloader` –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–Ω–æ —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ)

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- –ú–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–∫—Ä–∏—Ç–∏—á–Ω–æ)
1. ‚úÖ **–í—Å–µ —Å–¥–µ–ª–∞–Ω–æ** - –æ—Å–Ω–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
1. –í–µ—Ä–Ω—É—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é URL –≤ `LinkProcessingService.process_link()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. –û–±–Ω–æ–≤–∏—Ç—å use cases –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
3. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å `PlatformService` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `YtDlpService` –≤–º–µ—Å—Ç–æ `VideoDownloader`

### –í –±—É–¥—É—â–µ–º (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)
1. –£–¥–∞–ª–∏—Ç—å `VideoDownloader` –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. –£–¥–∞–ª–∏—Ç—å DEPRECATED –º–µ—Ç–æ–¥—ã –∏–∑ `BaseService`
3. –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!**

–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:
1. `bot.py` ‚Üí `DownloadManager.request_download()` ‚úÖ
2. `DownloadManager` ‚Üí `LinkProcessingService.process_link()` ‚Üí `LinkInfo` ‚úÖ
3. `DownloadManager` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚úÖ
4. `Worker` ‚Üí `LinkProcessingService` ‚Üí `DownloadPlan` ‚Üí `YtDlpService` ‚úÖ
5. `Worker` ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Telegram, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis ‚úÖ

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã, –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ç–∫–∏–µ. –ï—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `VideoDownloader`), –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –∏ –Ω–µ –º–µ—à–∞–µ—Ç —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º—ã.
